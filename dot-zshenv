#!/bin/zsh
alias compinit="compinit -d ~/.cache/zsh/compdump"
fpath=(~/.zsh/functions $fpath ~/.cache/zsh/compdump)

autoload -Uz zcompile zcompare 

function source {
	if [ -f "$1" ];then
		builtin source "$@"
	fi
}

if [ ! -d ~/.cache/zsh ];then
	rm -f ~/.cache/zsh
	mkdir -p ~/.cache/zsh
fi
# Traps
function TRAPUSR1 { rehash; }

# misc functions
function zcompinit {
	if [[ -o interactive ]];then
		compinit $@
		source $HOME/.zsh/compdef
		[[ $* =~ -[[:alnum:]]*C ]] || {
			local n k
			for n in $fpath[@];do
				if [[ -f $n ]] && [[ -w $n:P:h ]];then
					zcompare "$n"
				elif [[ -d $n ]] && [[ -w $n ]];then
					for k in "$n"/^*.zwc(^/);do
						zcompare "$k"
					done
				fi
			done
			compinit -C
			source $HOME/.zsh/compdef
		}
	fi
}

if [[ -o interactive ]];then
	autoload -Uz compinit
	setopt extendedglob
	source "$HOME/.zinputrc"
	source $HOME'/.shell/import'
	[ -z "$(get_term|grep 'geany')" ] && HISTFILE=${HISTFILE:-~/.zsh_history}
fi

source $HOME'/.shell/environment'
source /usr/share/doc/pkgfile/command-not-found.zsh
source ./.env_setup
