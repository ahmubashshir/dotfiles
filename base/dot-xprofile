#!/bin/sh
if [ -f ~/.config/shell/environment ]; then
	. ~/.config/shell/environment
fi

#services="ibus picom"
export GTK_IM_MODULE=ibus
export QT_IM_MODULE=ibus
export XMODIFIERS=@im=ibus
ibus-daemon -drx --panel ~/bin/ibus-ui-appindicator

dbus-update-activation-environment --all --systemd
systemctl --user --quiet start xorg.target

if command -pv xcape > /dev/null 2>&1; then
	awk '{if(NR>1) printf ";";if(length($0) > 1)printf "%s", $0} END{print ""}' "${XDG_CONFIG_HOME:-$HOME/.config}/X11/xcape.rc" |
		xcape -e "$(cat)"
fi

#xset +dpms
#xset s blank
if [ "$XDG_SESSION_DESKTOP" = "plasma" ]; then
	unset QT_AUTO_SCREEN_SCALE_FACTOR QT_SCALE_FACTOR QT_QPA_PLATFORMTHEME
	systemctl --user --quiet is-enabled deadd-notification-center.service &&
		systemctl --user stop deadd
else
	for service in $services; do
		systemctl --user restart "$service@$DISPLAY"
	done
	systemctl --user --quiet is-enabled deadd-notification-center.service &&
		systemctl --user restart deadd
fi
